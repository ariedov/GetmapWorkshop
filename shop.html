<!DOCTYPE html>
<html>

<head>
	<title>Художня майстерня Гетьман!</title>
	<meta charset="utf-8" />
	<link rel="stylesheet" type="text/css" href="css/grids-min.css">
	<link rel="stylesheet" type="text/css" href="css/style.css" />
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="css/bootstrap-theme.min.css" />
</head>

<body>
	<div id="main_container">
		<header>
			<nav class="pure-g-r">
				<div class="pure-u-1-6 nav-item">
					<img src="img/gallery_blue_bg.png" />
					<a href="index.html">галерея</a>
				</div>
				<div class="pure-u-1-6 nav-item">
					<img src="img/workshop_yellow_bg.png" />
					<a href="workshop.html">майстерня</a>
				</div>
				<div class="pure-u-1-3">
					<a href="index.html" class="logo_container">
						<img border="0" src="img/logo.png" alt="Getman Workshop" />
					</a>
				</div>
				<div class="pure-u-1-6 nav-item">
					<img src="img/store_orange_bg.png" />
					<a href="shop.html">крамничка</a>
				</div>
				<div class="pure-u-1-6 nav-item">
					<img src="img/contacts_green_bg.png" />
					<a href="contacts.html">контакти</a>
				</div>
			</nav>
		</header>

		<div id="main_table">
			<div class="progress">
				<div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
					<span class="sr-only">100% Complete</span>
				</div>
			</div>

			<div class="grid_alert">
				<div class="alert alert-success" role="alert">Замовлення успішно відправлене. Ми зв'яжемося з Вами якнайшивидше!</div>
				<div class="alert alert-danger" role="alert">Щось пішло не так. <a id="try_again" class="alert-link">Спробувати ще раз</a> або <a id="сancel_order" class="alert-link">відмінити.</a> </div>
			</div>
			<div class="items success grid" style="display: none;"></div>
			<p class="shop_error" style="display:none;">Сталася помилка завантаження.</a>
		</div>

		<!-- <footer style="position: absolute; bottom: 0;"> -->
		<!-- <div id="socials" class="pure-g-r"> -->
		<!-- <div class="social facebook pure-u-1-5"> -->
		<!-- <a href="#"> -->
		<!-- <img src="img/facebook_bg.png" class="social_bg" alt="facebook" /> -->
		<!-- <img src="img/facebook_fg.png" class="social_fg" alt="facebook" /> -->
		<!-- </a> -->
		<!-- </div> -->
		<!-- <div class="social pinterest pure-u-1-5"> -->
		<!-- <a href="#"> -->
		<!-- <img src="img/pinterest_bg.png" class="social_bg" alt="pinterest" /> -->
		<!-- <img src="img/pinterest_fg.png" class="social_fg" alt="pinterest" /> -->
		<!-- </a> -->
		<!-- </div> -->
		<!-- <div class="social behands pure-u-1-5">
						<a href="#">
							<img src="img/behands_bg.png" class="social_bg" alt="behands" />
							<img src="img/behands_fg.png" class="social_fg" alt="behands" />
						</a>
					</div>
					<div class="social gplus pure-u-1-5">
						<a href="#">
							<img src="img/gplus_bg.png" class="social_bg" alt="google plus" />
							<img src="img/gplus_fg.png" class="social_fg" alt="google plus" />
						</a>
					</div>
					<div class="social instagram pure-u-1-5">
						<a href="#">
							<img src="img/instagram_bg.png" class="social_bg" alt="instagram" />
							<img src="img/instagram_fg.png" class="social_fg" alt="instagram" />
						</a>
					</div>
				</div>
			</footer>
			<div id="all_rights_reserved">© Художня майстерня "Гетьман" 2008–2015 Копіювання матеріалів дозволяється лише з посиланням на джерело</div> -->
	</div>

	<div id="order_form" style="display:none;">
		<a class="close" onClick="hidePopup()">
			<img src="img/close_icon.png" />
		</a>
		<form id="make_order_form" role="form">
			<div class="form-group">
				<label for="name">Ім'я:</label>
				<input type="name" class="form-control" id="name" data-error="Будь-ласка, введіть своє ім'я." required/>
				<div class="help-block with-errors"></div>
			</div>
			<div class="form-group">
				<label for="email">Електронна адреса:</label>
				<input type="email" class="form-control" id="email" data-error="Будь-ласка, введіть вірну електронну адресу." required/>
				<div class="help-block with-errors"></div>
			</div>
			<div class="form-group">
				<label for="phone">Номер телефону:</label>
				<input type="tel" class="form-control" id="phone" pattern="^([0-9\(\)\/\+ \-]*)$" data-error="Будь-ласка, введіть вірний номер телефону." required/>
				<div class="help-block with-errors"></div>
			</div>
			<div class="form-group">
				<label for="notes">Додатково:</label>
				<textarea class="form-control" id="notes"></textarea>
			</div>
			<button type="submit" class="btn btn-default">Замовити</button>
		</form>
	</div>

	<script src="js/jquery.js"></script>
	<script src="js/parse-1.5.0.js"></script>
	<script src="js/masonry.pkgd.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/validator.min.js"></script>

	<script type="text/javascript">
		var selectedItem = {};

		Parse.initialize("MbW4yrekRDJBgv4Jso9ewuzzfpCid9hFkbHS4cLH", "hFINR7Q8QINAcRy5olXj7NbR4xa6PhEpr1AWv6Zm");
		var product = Parse.Object.extend("product");
		var query = new Parse.Query(product);
		query.find({
			success: function(object) {
				$(".progress").fadeOut();

				var views = "";
				for (var i = object.length - 1; i >= 0; --i) {
					var item = object[i].attributes;
					var name = item.name;
					var price = item.price;
					var description = item.description;
					var author = item.author;
					var image = item.image;
					var itemView = "" +
						"<div class=\"grid-item\"> \
								<img class=\"itemimage\" src=\"" + image + "\" />  \
								<p class=\"name\">" + name + "</p> \
									<p>" + description + "</p> \
									<p>" + author +
						"</p> \
									<div class=\"action\"> \
										<span class=\"price\">" + price + " UAH</span> \
										<span class=\"buy\"><a onClick=\"showPopup(\'" + escape(name) + "\',\'" + escape(price) + "\', \'" + escape(description) +
						"\', \'" + escape(author) + "\', \'" + escape(image) + "\')\"><img src=\"img/insect.png\" /> ПРИДБАТИ</a></span> \
									</div> \
								</div>";

					$(itemView).find(".itemimage").load(function() {
						$('.grid').masonry('layout');
					});

					views += itemView;
				}
				$(".items").append(views);
				// $(".success").text(object);
				$(".success").show(function() {
					$('.grid').masonry('layout');
				});
				$('.grid').masonry({
					itemSelector: '.grid-item',
					columnWidth: 200,
					gutter: 10
				});
			},
			error: function(model, error) {
				$(".progress").fadeOut();
				$(".error").show();
			}
		});

		$("#make_order_form").validator().on('submit', function(e) {
			if (!e.isDefaultPrevented()) {
				makeOrder();
			}
			return false;
		});

		$("#try_again").click(function() {
			$(".alert-danger").fadeOut();
			makeOrder();
		});
		$("#сancel_order").click(function() {
			$(".alert-danger").fadeOut();
		});

		function showPopup(name, price, description, author, image) {
			hidePopup();
			selectedItem.productName = name;
			selectedItem.productCost = price;
			selectedItem.productDescription = description;
			selectedItem.productAuthor = author;
			selectedItem.productImage = image;
			$("#order_form").fadeIn(100);
			return false;
		}

		function hidePopup() {
			$("#order_form").fadeOut(100);
			return false;
		}

		function makeOrder() {
			selectedItem.name = $("#name").val();
			selectedItem.phone = $("#phone").val();
			selectedItem.email = $("#email").val();
			selectedItem.description = $("#notes").val();
			$.post("http://getmanstudio.herokuapp.com/order/", selectedItem)
				.done(function(data) {
					$(".alert-success").fadeIn();
					$(".alert-success").delay(2000).fadeOut();
					$(".alert-danger").fadeOut();
					$(".progress").fadeOut();
				})
				.fail(function(data) {
					$(".alert-danger").fadeIn();
					$(".alert-sucess").fadeOut();
					$(".progress").fadeOut();
				});

			$(".progress").fadeIn();
			$("#order_form").fadeOut(100);
			return false;
		}
	</script>

</body>

</html>
